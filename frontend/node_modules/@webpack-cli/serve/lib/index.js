"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const cli_flags_1 = require("webpack-dev-server/bin/cli-flags");
const webpack_cli_1 = __importDefault(require("webpack-cli"));
const startDevServer_1 = __importDefault(require("./startDevServer"));
const args_to_camel_case_1 = __importDefault(require("./args-to-camel-case"));
/**
 *
 * Creates a webpack compiler and runs the devServer
 *
 * @param {String[]} args - args processed from the CLI
 * @returns {Function} invokes the devServer API
 */
function serve(...args) {
    const cli = new webpack_cli_1.default();
    const core = cli.getCoreFlags();
    // partial parsing usage: https://github.com/75lb/command-line-args/wiki/Partial-parsing
    // since the webpack flags have the 'entry' option set as it's default option,
    // we need to parse the dev server args first. Otherwise, the webpack parsing could snatch
    // one of the dev server's options and set it to this 'entry' option.
    // see: https://github.com/75lb/command-line-args/blob/master/doc/option-definition.md#optiondefaultoption--boolean
    const devServerArgs = cli.commandLineArgs(cli_flags_1.devServer, { argv: args, partial: true });
    const webpackArgs = cli.commandLineArgs(core, { argv: devServerArgs._unknown || [], stopAtFirstUnknown: false });
    const finalArgs = args_to_camel_case_1.default(devServerArgs._all || {});
    // pass along the 'hot' argument to the dev server if it exists
    if (webpackArgs && webpackArgs._all && typeof webpackArgs._all.hot !== 'undefined') {
        finalArgs['hot'] = webpackArgs._all.hot;
    }
    cli.getCompiler(webpackArgs, core).then((compiler) => {
        startDevServer_1.default(compiler, finalArgs);
    });
}
exports.default = serve;
//# sourceMappingURL=index.js.map